@page "/Random"
@using CTMS.DataModel.Models.Systems
@using CTMS.Share.Helpers
@using Newtonsoft.Json
@layout EmptyLayout
@inject NavigationManager NavigationManager

@inject NavigationManager NavigationManager
@inject CurrentUserService CurrentUserService
@inject AuthenticationStateHelper AuthenticationStateHelper
@inject AuthenticationStateProvider authStateProvider

@using Microsoft.Extensions.Options
@inject IOptions<CTMSSettings> options
@inject RandomListService RandomListService

<PageTitle>隨機表</PageTitle>

@if (string.IsNullOrEmpty(RoleMessage) == false)
{
    <div class="alert alert-danger" role="alert">
        @RoleMessage
    </div>
}
else
{
    <div>
        <AdminHeaderView />

        <div class="page-body">
            <MudTabs PanelClass="pa-6" AlwaysShowScrollButtons="true">
                <MudTabPanel Text="成大 EC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix成大醫院" />
                </MudTabPanel>
                <MudTabPanel Text="成大 OC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix成大醫院" />
                </MudTabPanel>
                <MudTabPanel Text="成大 EC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix成大醫院" />
                </MudTabPanel>
                <MudTabPanel Text="成大 OC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix成大醫院" />
                </MudTabPanel>

                <MudTabPanel Text="奇美 EC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix奇美醫院" />
                </MudTabPanel>
                <MudTabPanel Text="奇美 OC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix奇美醫院" />
                </MudTabPanel>
                <MudTabPanel Text="奇美 EC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix奇美醫院" />
                </MudTabPanel>
                <MudTabPanel Text="奇美 OC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix奇美醫院" />
                </MudTabPanel>

                <MudTabPanel Text="郭綜合 EC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix郭綜合醫院" />
                </MudTabPanel>
                <MudTabPanel Text="郭綜合 OC Early">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomEarly"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix郭綜合醫院" />
                </MudTabPanel>
                <MudTabPanel Text="郭綜合 EC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.EC" Hospital="@MagicObjectHelper.prefix郭綜合醫院" />
                </MudTabPanel>
                <MudTabPanel Text="郭綜合 OC Advance">
                    <RandomView EarlyOrAdvance="@MagicObjectHelper.RandomAdvance"
                                ECorOC="@MagicObjectHelper.OC" Hospital="@MagicObjectHelper.prefix郭綜合醫院" />
                </MudTabPanel>
                <MudTabPanel Text="最後自動編號">
                    <LastSubjectNoView/>
                </MudTabPanel>
            </MudTabs>
        </div>
    </div>
}

<MessageBox Height="@MessageBox.Height" Width="@MessageBox.Width"
            IsVisible="@MessageBox.IsVisible"
            Title="@MessageBox.Title" Message="@MessageBox.Body"
            Callback="MessageBox.MessageDelegate" />

<ConfirmBox Height="@ConfirmMessageBox.Height" Width="@ConfirmMessageBox.Width"
            IsVisible="@ConfirmMessageBox.IsVisible"
            Title="@ConfirmMessageBox.Title" Message="@ConfirmMessageBox.Body"
            Callback="ConfirmMessageBox.ConfirmDelegate" />

<DialogBackground />

@code {
    [Parameter]
    public string Code { get; set; }

    ConfirmBoxModel ConfirmMessageBox { get; set; } = new ConfirmBoxModel();
    MessageBoxModel MessageBox { get; set; } = new MessageBoxModel();
    string RoleMessage = string.Empty;

    protected override void OnInitialized()
    {
    }

    protected override async Task OnInitializedAsync()
    {
        var checkResult = await AuthenticationStateHelper
        .Check(authStateProvider, NavigationManager);
        if (checkResult == true)
        {
            if (AuthenticationStateHelper.CheckIsAdmin() == false)
            {
                RoleMessage = MagicObjectHelper.你沒有權限存取此頁面;
            }
        }
    }
}
